<link rel="import" href="../polymer/polymer.html">
<script src='./vars.js'></script>
<dom-module id="ac-synthesizer">
    <template>
        <style></style>
    </template>
    <script>
        Polymer({
            is: "ac-synthesizer",
            observers: [],
            behaviors: [],
            listeners: {},
            properties: {},
            loadAudio: function (url) {
                var AudioContext = AudioContext || webkitAudioContext;
                var context = new AudioContext();
                var convolver = context.createConvolver();

                var ajaxRequest = new XMLHttpRequest();
                ajaxRequest.open('GET', 'https://dl.dropboxusercontent.com/s/v3hwaojdxrono5t/factory.hall.wav?dl=0', true);
                ajaxRequest.responseType = 'arraybuffer';
                ajaxRequest.onload = function () {
                    context.decodeAudioData(ajaxRequest.response, function (buffer) {
                        
                        convolver.buffer = buffer;
                        var request = new XMLHttpRequest();
                        request.open('GET', url, true);
                        request.responseType = 'arraybuffer';
                        request.onload = function () {
                            context.decodeAudioData(request.response, function (buffer) {
                                var s = context.createBufferSource();
                                s.buffer = buffer;
                                // s.loop=true ;
                                s.connect(convolver);
                                convolver.connect(context.destination);
                                s.start();
                            });
                        };
                        request.send();
                    });
                };
                ajaxRequest.send();


            },
            ready: function () {
                this.loadAudio("https://dl.dropboxusercontent.com/s/bwlqwxhfoaaerx1/65l.mp3?dl=0");
            }
        });
    </script>
</dom-module>
